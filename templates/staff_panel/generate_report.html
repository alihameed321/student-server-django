{% extends 'base/base.html' %}
{% load static %}

{% block title %}Generate Report - Staff Panel{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-6xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'staff_panel:reports' %}" 
                       class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </a>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Generate Report</h1>
                        <p class="mt-2 text-gray-600">Create custom reports and analytics</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <!-- Report Configuration -->
            <div class="lg:col-span-2">
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Report Configuration</h2>
                    
                    <form id="reportForm" class="space-y-6">
                        <!-- Report Type -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Report Type</label>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="report_type" value="student" class="mr-3" checked>
                                    <div>
                                        <div class="font-medium text-gray-900">Student Report</div>
                                        <div class="text-sm text-gray-500">Enrollment, demographics, academic performance</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="report_type" value="financial" class="mr-3">
                                    <div>
                                        <div class="font-medium text-gray-900">Financial Report</div>
                                        <div class="text-sm text-gray-500">Payments, fees, revenue analysis</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="report_type" value="request" class="mr-3">
                                    <div>
                                        <div class="font-medium text-gray-900">Request Report</div>
                                        <div class="text-sm text-gray-500">Service requests, processing times</div>
                                    </div>
                                </label>
                                <label class="flex items-center p-4 border border-gray-200 rounded-lg cursor-pointer hover:bg-gray-50">
                                    <input type="radio" name="report_type" value="activity" class="mr-3">
                                    <div>
                                        <div class="font-medium text-gray-900">Activity Report</div>
                                        <div class="text-sm text-gray-500">System usage, user activity</div>
                                    </div>
                                </label>
                            </div>
                        </div>

                        <!-- Date Range -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Date Range</label>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">From Date</label>
                                    <input type="date" id="start_date" name="start_date" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">To Date</label>
                                    <input type="date" id="end_date" name="end_date" 
                                           class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                </div>
                                <div>
                                    <label class="block text-xs text-gray-500 mb-1">Quick Select</label>
                                    <select id="date_preset" onchange="setDatePreset()" 
                                            class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                        <option value="">Custom Range</option>
                                        <option value="today">Today</option>
                                        <option value="yesterday">Yesterday</option>
                                        <option value="last_7_days">Last 7 Days</option>
                                        <option value="last_30_days">Last 30 Days</option>
                                        <option value="this_month">This Month</option>
                                        <option value="last_month">Last Month</option>
                                        <option value="this_year">This Year</option>
                                        <option value="last_year">Last Year</option>
                                    </select>
                                </div>
                            </div>
                        </div>

                        <!-- Filters -->
                        <div id="filters-section">
                            <label class="block text-sm font-medium text-gray-700 mb-3">Filters</label>
                            
                            <!-- Student Filters -->
                            <div id="student-filters" class="filter-group">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Program</label>
                                        <select name="program" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Programs</option>
                                            <option value="Computer Science">Computer Science</option>
                                            <option value="Business Administration">Business Administration</option>
                                            <option value="Engineering">Engineering</option>
                                            <option value="Medicine">Medicine</option>
                                            <option value="Law">Law</option>
                                            <option value="Arts">Arts</option>
                                            <option value="Science">Science</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Year</label>
                                        <select name="year" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Years</option>
                                            <option value="1">1st Year</option>
                                            <option value="2">2nd Year</option>
                                            <option value="3">3rd Year</option>
                                            <option value="4">4th Year</option>
                                            <option value="Graduate">Graduate</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Status</label>
                                        <select name="status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Status</option>
                                            <option value="active">Active</option>
                                            <option value="inactive">Inactive</option>
                                            <option value="graduated">Graduated</option>
                                            <option value="suspended">Suspended</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Financial Filters -->
                            <div id="financial-filters" class="filter-group hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Payment Status</label>
                                        <select name="payment_status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Payments</option>
                                            <option value="paid">Paid</option>
                                            <option value="pending">Pending</option>
                                            <option value="overdue">Overdue</option>
                                            <option value="cancelled">Cancelled</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Fee Type</label>
                                        <select name="fee_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Fee Types</option>
                                            <option value="tuition">Tuition</option>
                                            <option value="library">Library</option>
                                            <option value="lab">Laboratory</option>
                                            <option value="sports">Sports</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Amount Range</label>
                                        <select name="amount_range" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Amounts</option>
                                            <option value="0-100">$0 - $100</option>
                                            <option value="100-500">$100 - $500</option>
                                            <option value="500-1000">$500 - $1,000</option>
                                            <option value="1000+">$1,000+</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Request Filters -->
                            <div id="request-filters" class="filter-group hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Request Type</label>
                                        <select name="request_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Types</option>
                                            <option value="transcript">Transcript</option>
                                            <option value="certificate">Certificate</option>
                                            <option value="enrollment">Enrollment Verification</option>
                                            <option value="grade_change">Grade Change</option>
                                            <option value="other">Other</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Request Status</label>
                                        <select name="request_status" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Status</option>
                                            <option value="pending">Pending</option>
                                            <option value="in_progress">In Progress</option>
                                            <option value="completed">Completed</option>
                                            <option value="rejected">Rejected</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Priority</label>
                                        <select name="priority" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Priorities</option>
                                            <option value="low">Low</option>
                                            <option value="medium">Medium</option>
                                            <option value="high">High</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                </div>
                            </div>

                            <!-- Activity Filters -->
                            <div id="activity-filters" class="filter-group hidden">
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Activity Type</label>
                                        <select name="activity_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Activities</option>
                                            <option value="login">Login</option>
                                            <option value="logout">Logout</option>
                                            <option value="request_submit">Request Submission</option>
                                            <option value="payment">Payment</option>
                                            <option value="profile_update">Profile Update</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">User Type</label>
                                        <select name="user_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Users</option>
                                            <option value="student">Students</option>
                                            <option value="staff">Staff</option>
                                            <option value="admin">Administrators</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-xs text-gray-500 mb-1">Device Type</label>
                                        <select name="device_type" class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500">
                                            <option value="">All Devices</option>
                                            <option value="desktop">Desktop</option>
                                            <option value="mobile">Mobile</option>
                                            <option value="tablet">Tablet</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Output Format -->
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-3">Output Format</label>
                            <div class="flex space-x-4">
                                <label class="flex items-center">
                                    <input type="radio" name="format" value="pdf" class="mr-2" checked>
                                    <i class="fas fa-file-pdf text-red-500 mr-1"></i>
                                    <span>PDF</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="format" value="excel" class="mr-2">
                                    <i class="fas fa-file-excel text-green-500 mr-1"></i>
                                    <span>Excel</span>
                                </label>
                                <label class="flex items-center">
                                    <input type="radio" name="format" value="csv" class="mr-2">
                                    <i class="fas fa-file-csv text-blue-500 mr-1"></i>
                                    <span>CSV</span>
                                </label>
                            </div>
                        </div>

                        <!-- Generate Button -->
                        <div class="pt-6 border-t border-gray-200">
                            <button type="button" onclick="generateReport()" 
                                    class="w-full bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors">
                                <i class="fas fa-chart-bar mr-2"></i>Generate Report
                            </button>
                        </div>
                    </form>
                </div>
            </div>

            <!-- Report Preview & Quick Stats -->
            <div>
                <!-- Quick Stats -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6 mb-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Quick Stats</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Total Students</span>
                            <span class="text-sm font-medium text-gray-900">{{ total_students|default:"1,234" }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Active Requests</span>
                            <span class="text-sm font-medium text-gray-900">{{ active_requests|default:"56" }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">Pending Payments</span>
                            <span class="text-sm font-medium text-gray-900">${{ pending_payments|default:"12,450" }}</span>
                        </div>
                        <div class="flex items-center justify-between">
                            <span class="text-sm text-gray-600">This Month Revenue</span>
                            <span class="text-sm font-medium text-gray-900">${{ monthly_revenue|default:"45,230" }}</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Reports -->
                <div class="bg-white rounded-lg shadow-sm border border-gray-200 p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Recent Reports</h3>
                    <div class="space-y-3">
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <div class="text-sm font-medium text-gray-900">Student Enrollment Report</div>
                                <div class="text-xs text-gray-500">Generated 2 hours ago</div>
                            </div>
                            <button class="text-blue-600 hover:text-blue-800 text-sm">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <div class="text-sm font-medium text-gray-900">Financial Summary</div>
                                <div class="text-xs text-gray-500">Generated yesterday</div>
                            </div>
                            <button class="text-blue-600 hover:text-blue-800 text-sm">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-gray-50 rounded-lg">
                            <div>
                                <div class="text-sm font-medium text-gray-900">Request Analytics</div>
                                <div class="text-xs text-gray-500">Generated 3 days ago</div>
                            </div>
                            <button class="text-blue-600 hover:text-blue-800 text-sm">
                                <i class="fas fa-download"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Loading Modal -->
<div id="loadingModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 hidden z-50">
    <div class="flex items-center justify-center min-h-screen">
        <div class="bg-white rounded-lg shadow-xl p-6 max-w-sm w-full mx-4">
            <div class="text-center">
                <div class="animate-spin rounded-full h-12 w-12 border-b-2 border-blue-600 mx-auto mb-4"></div>
                <h3 class="text-lg font-semibold text-gray-900 mb-2">Generating Report</h3>
                <p class="text-gray-600">Please wait while we compile your report...</p>
            </div>
        </div>
    </div>
</div>

<script>
// Show/hide filters based on report type
document.querySelectorAll('input[name="report_type"]').forEach(radio => {
    radio.addEventListener('change', function() {
        // Hide all filter groups
        document.querySelectorAll('.filter-group').forEach(group => {
            group.classList.add('hidden');
        });
        
        // Show relevant filter group
        const filterGroup = document.getElementById(this.value + '-filters');
        if (filterGroup) {
            filterGroup.classList.remove('hidden');
        }
    });
});

// Date preset functionality
function setDatePreset() {
    const preset = document.getElementById('date_preset').value;
    const startDate = document.getElementById('start_date');
    const endDate = document.getElementById('end_date');
    const today = new Date();
    
    switch(preset) {
        case 'today':
            startDate.value = today.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'yesterday':
            const yesterday = new Date(today);
            yesterday.setDate(yesterday.getDate() - 1);
            startDate.value = yesterday.toISOString().split('T')[0];
            endDate.value = yesterday.toISOString().split('T')[0];
            break;
        case 'last_7_days':
            const week = new Date(today);
            week.setDate(week.getDate() - 7);
            startDate.value = week.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'last_30_days':
            const month = new Date(today);
            month.setDate(month.getDate() - 30);
            startDate.value = month.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'this_month':
            const firstDay = new Date(today.getFullYear(), today.getMonth(), 1);
            startDate.value = firstDay.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'last_month':
            const lastMonthStart = new Date(today.getFullYear(), today.getMonth() - 1, 1);
            const lastMonthEnd = new Date(today.getFullYear(), today.getMonth(), 0);
            startDate.value = lastMonthStart.toISOString().split('T')[0];
            endDate.value = lastMonthEnd.toISOString().split('T')[0];
            break;
        case 'this_year':
            const yearStart = new Date(today.getFullYear(), 0, 1);
            startDate.value = yearStart.toISOString().split('T')[0];
            endDate.value = today.toISOString().split('T')[0];
            break;
        case 'last_year':
            const lastYearStart = new Date(today.getFullYear() - 1, 0, 1);
            const lastYearEnd = new Date(today.getFullYear() - 1, 11, 31);
            startDate.value = lastYearStart.toISOString().split('T')[0];
            endDate.value = lastYearEnd.toISOString().split('T')[0];
            break;
    }
}

// Generate report function
function generateReport() {
    // Show loading modal
    document.getElementById('loadingModal').classList.remove('hidden');
    
    // Simulate report generation
    setTimeout(() => {
        document.getElementById('loadingModal').classList.add('hidden');
        alert('Report generated successfully! Download will start shortly.');
        // Here you would typically trigger the actual download
    }, 3000);
}

// Set default dates
document.addEventListener('DOMContentLoaded', function() {
    const today = new Date();
    const lastMonth = new Date(today);
    lastMonth.setMonth(lastMonth.getMonth() - 1);
    
    document.getElementById('start_date').value = lastMonth.toISOString().split('T')[0];
    document.getElementById('end_date').value = today.toISOString().split('T')[0];
});
</script>
{% endblock %}