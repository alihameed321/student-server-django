{% extends 'base/base.html' %}
{% load static %}

{% block title %}Create Announcement - Staff Panel{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'staff_panel:announcement_management' %}" 
                       class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </a>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">Create Announcement</h1>
                        <p class="mt-2 text-gray-600">Share important information with students</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Announcement Form -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <form method="post" enctype="multipart/form-data" class="p-6">
                {% csrf_token %}
                
                <!-- Basic Information Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Announcement Details</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                                Title <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="title" name="title" required
                                   placeholder="Enter announcement title"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                                Content <span class="text-red-500">*</span>
                            </label>
                            <textarea id="content" name="content" rows="8" required
                                      placeholder="Write your announcement content here..."
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                            <p class="text-sm text-gray-500 mt-1">You can use basic formatting and line breaks</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Announcement Settings</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="priority" class="block text-sm font-medium text-gray-700 mb-2">
                                Priority <span class="text-red-500">*</span>
                            </label>
                            <select id="priority" name="priority" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select Priority</option>
                                <option value="low">Low - General Information</option>
                                <option value="medium">Medium - Important Notice</option>
                                <option value="high">High - Urgent Announcement</option>
                                <option value="critical">Critical - Emergency Alert</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-700 mb-2">
                                Category
                            </label>
                            <select id="category" name="category"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select Category</option>
                                <option value="academic">Academic</option>
                                <option value="administrative">Administrative</option>
                                <option value="events">Events</option>
                                <option value="deadlines">Deadlines</option>
                                <option value="maintenance">Maintenance</option>
                                <option value="emergency">Emergency</option>
                                <option value="general">General</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="target_audience" class="block text-sm font-medium text-gray-700 mb-2">
                                Target Audience <span class="text-red-500">*</span>
                            </label>
                            <select id="target_audience" name="target_audience" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select Audience</option>
                                <option value="all">All Students</option>
                                <option value="undergraduate">Undergraduate Students</option>
                                <option value="graduate">Graduate Students</option>
                                <option value="year_1">1st Year Students</option>
                                <option value="year_2">2nd Year Students</option>
                                <option value="year_3">3rd Year Students</option>
                                <option value="year_4">4th Year Students</option>
                                <option value="specific_program">Specific Program</option>
                            </select>
                        </div>
                        
                        <div id="program_selection" class="hidden">
                            <label for="specific_program" class="block text-sm font-medium text-gray-700 mb-2">
                                Select Program
                            </label>
                            <select id="specific_program" name="specific_program"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">Select Program</option>
                                <option value="Computer Science">Computer Science</option>
                                <option value="Business Administration">Business Administration</option>
                                <option value="Engineering">Engineering</option>
                                <option value="Medicine">Medicine</option>
                                <option value="Law">Law</option>
                                <option value="Arts">Arts</option>
                                <option value="Science">Science</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Scheduling Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Publishing Schedule</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="publish_date" class="block text-sm font-medium text-gray-700 mb-2">
                                Publish Date
                            </label>
                            <input type="datetime-local" id="publish_date" name="publish_date"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">Leave empty to publish immediately</p>
                        </div>
                        
                        <div>
                            <label for="expiry_date" class="block text-sm font-medium text-gray-700 mb-2">
                                Expiry Date
                            </label>
                            <input type="datetime-local" id="expiry_date" name="expiry_date"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">Leave empty for no expiry</p>
                        </div>
                    </div>
                </div>

                <!-- Attachments Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Attachments</h2>
                    <div>
                        <label for="attachments" class="block text-sm font-medium text-gray-700 mb-2">
                            Upload Files
                        </label>
                        <input type="file" id="attachments" name="attachments" multiple
                               accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">Accepted formats: PDF, DOC, DOCX, JPG, PNG, GIF (Max 10MB per file)</p>
                        <div id="file-list" class="mt-3 space-y-2"></div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Notification Settings</h2>
                    <div class="space-y-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="send_email" name="send_email" checked
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">Send email notification to target audience</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="send_sms" name="send_sms"
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">Send SMS notification (for high priority announcements)</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="pin_announcement" name="pin_announcement"
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">Pin announcement to top of announcements page</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="is_active" name="is_active" checked
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">Announcement is active</span>
                        </label>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">Preview</h2>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <div id="preview-content">
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-eye text-3xl mb-2"></i>
                                <p>Preview will appear here as you type</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <div class="flex space-x-3">
                        <button type="button" onclick="saveDraft()" 
                                class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-save mr-2"></i>Save Draft
                        </button>
                        <button type="button" onclick="previewAnnouncement()" 
                                class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-eye mr-2"></i>Preview
                        </button>
                    </div>
                    <div class="flex space-x-3">
                        <a href="{% url 'staff_panel:announcement_management' %}" 
                           class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors">
                            Cancel
                        </a>
                        <button type="submit" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-bullhorn mr-2"></i>Publish Announcement
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Show/hide program selection based on target audience
document.getElementById('target_audience').addEventListener('change', function() {
    const programSelection = document.getElementById('program_selection');
    if (this.value === 'specific_program') {
        programSelection.classList.remove('hidden');
        document.getElementById('specific_program').required = true;
    } else {
        programSelection.classList.add('hidden');
        document.getElementById('specific_program').required = false;
    }
});

// File upload handling
document.getElementById('attachments').addEventListener('change', function(e) {
    const fileList = document.getElementById('file-list');
    fileList.innerHTML = '';
    
    Array.from(e.target.files).forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'flex items-center justify-between bg-white border border-gray-200 rounded p-2';
        fileItem.innerHTML = `
            <div class="flex items-center">
                <i class="fas fa-file text-gray-400 mr-2"></i>
                <span class="text-sm text-gray-700">${file.name}</span>
                <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
            </div>
            <button type="button" onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                <i class="fas fa-times"></i>
            </button>
        `;
        fileList.appendChild(fileItem);
    });
});

// Live preview functionality
function updatePreview() {
    const title = document.getElementById('title').value;
    const content = document.getElementById('content').value;
    const priority = document.getElementById('priority').value;
    const category = document.getElementById('category').value;
    
    const previewContent = document.getElementById('preview-content');
    
    if (title || content) {
        const priorityColors = {
            'low': 'bg-blue-100 text-blue-800',
            'medium': 'bg-yellow-100 text-yellow-800',
            'high': 'bg-orange-100 text-orange-800',
            'critical': 'bg-red-100 text-red-800'
        };
        
        previewContent.innerHTML = `
            <div class="text-left">
                <div class="flex items-center space-x-2 mb-3">
                    ${priority ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityColors[priority] || 'bg-gray-100 text-gray-800'}">\n                        ${priority.charAt(0).toUpperCase() + priority.slice(1)} Priority\n                    </span>` : ''}
                    ${category ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">\n                        ${category.charAt(0).toUpperCase() + category.slice(1)}\n                    </span>` : ''}
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">${title || 'Announcement Title'}</h3>
                <div class="text-gray-700 whitespace-pre-line">${content || 'Announcement content will appear here...'}</div>
                <div class="mt-4 text-sm text-gray-500">
                    <i class="fas fa-user mr-1"></i>Posted by Staff
                    <i class="fas fa-calendar ml-3 mr-1"></i>${new Date().toLocaleDateString()}
                </div>
            </div>
        `;
    } else {
        previewContent.innerHTML = `
            <div class="text-center text-gray-500 py-8">
                <i class="fas fa-eye text-3xl mb-2"></i>
                <p>Preview will appear here as you type</p>
            </div>
        `;
    }
}

// Add event listeners for live preview
document.getElementById('title').addEventListener('input', updatePreview);
document.getElementById('content').addEventListener('input', updatePreview);
document.getElementById('priority').addEventListener('change', updatePreview);
document.getElementById('category').addEventListener('change', updatePreview);

// Set default publish date to now
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('publish_date').value = now.toISOString().slice(0, 16);
});

function removeFile(index) {
    // This would need to be implemented with proper file handling
    console.log('Remove file at index:', index);
}

function saveDraft() {
    alert('Draft saved successfully!');
}

function previewAnnouncement() {
    // Open preview in new window or modal
    alert('Preview functionality will open in a new window.');
}
</script>
{% endblock %}