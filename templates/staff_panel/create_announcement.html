{% extends 'base/base.html' %}
{% load static %}

{% block title %}إنشاء إعلان - لوحة الموظفين{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8">
    <div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8">
        <!-- Header -->
        <div class="mb-8">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-4">
                    <a href="{% url 'staff_panel:announcement_management' %}" 
                       class="text-gray-500 hover:text-gray-700">
                        <i class="fas fa-arrow-left text-xl"></i>
                    </a>
                    <div>
                        <h1 class="text-3xl font-bold text-gray-900">إنشاء إعلان</h1>
                        <p class="mt-2 text-gray-600">شارك المعلومات المهمة مع الطلاب</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Create Announcement Form -->
        <div class="bg-white rounded-lg shadow-sm border border-gray-200">
            <form method="post" enctype="multipart/form-data" class="p-6">
                {% csrf_token %}
                
                <!-- Basic Information Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">تفاصيل الإعلان</h2>
                    <div class="space-y-6">
                        <div>
                            <label for="title" class="block text-sm font-medium text-gray-700 mb-2">
                                العنوان <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="title" name="title" required
                                   placeholder="أدخل عنوان الإعلان"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        </div>
                        
                        <div>
                            <label for="content" class="block text-sm font-medium text-gray-700 mb-2">
                                المحتوى <span class="text-red-500">*</span>
                            </label>
                            <textarea id="content" name="content" rows="8" required
                                      placeholder="اكتب محتوى الإعلان هنا..."
                                      class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"></textarea>
                            <p class="text-sm text-gray-500 mt-1">يمكنك استخدام التنسيق الأساسي وفواصل الأسطر</p>
                        </div>
                    </div>
                </div>

                <!-- Settings Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">إعدادات الإعلان</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="priority" class="block text-sm font-medium text-gray-700 mb-2">
                                الأولوية <span class="text-red-500">*</span>
                            </label>
                            <select id="priority" name="priority" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">اختر الأولوية</option>
                                <option value="low">منخفضة - معلومات عامة</option>
                                <option value="medium">متوسطة - إشعار مهم</option>
                                <option value="high">عالية - إعلان مهم</option>
                                <option value="urgent">عاجل - تنبيه طوارئ</option>
                            </select>
                        </div>
                        
                        <div>
                            <label for="target_audience" class="block text-sm font-medium text-gray-700 mb-2">
                                الجمهور المستهدف <span class="text-red-500">*</span>
                            </label>
                            <select id="target_audience" name="target_audience" required
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">اختر الجمهور</option>
                                <option value="all">جميع الطلاب</option>
                                <option value="undergraduate">طلاب البكالوريوس</option>
                                <option value="graduate">طلاب الدراسات العليا</option>
                                <option value="year_1">طلاب السنة الأولى</option>
                                <option value="year_2">طلاب السنة الثانية</option>
                                <option value="year_3">طلاب السنة الثالثة</option>
                                <option value="year_4">طلاب السنة الرابعة</option>
                                <option value="specific_program">برنامج محدد</option>
                            </select>
                        </div>
                        
                        <div id="program_selection" class="hidden">
                            <label for="specific_program" class="block text-sm font-medium text-gray-700 mb-2">
                                اختر البرنامج
                            </label>
                            <select id="specific_program" name="specific_program"
                                    class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                                <option value="">اختر البرنامج</option>
                                <option value="Computer Science">علوم الحاسوب</option>
                                <option value="Business Administration">إدارة الأعمال</option>
                                <option value="Engineering">الهندسة</option>
                                <option value="Medicine">الطب</option>
                                <option value="Law">القانون</option>
                                <option value="Arts">الآداب</option>
                                <option value="Science">العلوم</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Scheduling Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">جدولة النشر</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="publish_date" class="block text-sm font-medium text-gray-700 mb-2">
                                تاريخ النشر
                            </label>
                            <input type="datetime-local" id="publish_date" name="publish_date"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">اتركه فارغاً للنشر فوراً</p>
                        </div>
                        
                        <div>
                            <label for="expiry_date" class="block text-sm font-medium text-gray-700 mb-2">
                                تاريخ الانتهاء
                            </label>
                            <input type="datetime-local" id="expiry_date" name="expiry_date"
                                   class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                            <p class="text-sm text-gray-500 mt-1">اتركه فارغاً لعدم الانتهاء</p>
                        </div>
                    </div>
                </div>

                <!-- Attachments Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">المرفقات</h2>
                    <div>
                        <label for="attachments" class="block text-sm font-medium text-gray-700 mb-2">
                            رفع الملفات
                        </label>
                        <input type="file" id="attachments" name="attachments" multiple
                               accept=".pdf,.doc,.docx,.jpg,.jpeg,.png,.gif"
                               class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                        <p class="text-sm text-gray-500 mt-1">الصيغ المقبولة: PDF, DOC, DOCX, JPG, PNG, GIF (حد أقصى 10 ميجابايت لكل ملف)</p>
                        <div id="file-list" class="mt-3 space-y-2"></div>
                    </div>
                </div>

                <!-- Notification Settings -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">إعدادات الإشعارات</h2>
                    <div class="space-y-4">
                        <label class="flex items-center">
                            <input type="checkbox" id="send_email" name="send_email" checked
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">إرسال إشعار بريد إلكتروني للجمهور المستهدف</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="send_sms" name="send_sms"
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">إرسال إشعار رسالة نصية (للإعلانات عالية الأولوية)</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="pin_announcement" name="pin_announcement"
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">تثبيت الإعلان في أعلى صفحة الإعلانات</span>
                        </label>
                        
                        <label class="flex items-center">
                            <input type="checkbox" id="is_active" name="is_active" checked
                                   class="rounded border-gray-300 text-blue-600 shadow-sm focus:border-blue-300 focus:ring focus:ring-blue-200 focus:ring-opacity-50">
                            <span class="ml-2 text-sm text-gray-700">الإعلان نشط</span>
                        </label>
                    </div>
                </div>

                <!-- Preview Section -->
                <div class="mb-8">
                    <h2 class="text-xl font-semibold text-gray-900 mb-6">معاينة</h2>
                    <div class="bg-gray-50 border border-gray-200 rounded-lg p-6">
                        <div id="preview-content">
                            <div class="text-center text-gray-500 py-8">
                                <i class="fas fa-eye text-3xl mb-2"></i>
                                <p>ستظهر المعاينة هنا أثناء الكتابة</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Form Actions -->
                <div class="flex items-center justify-between pt-6 border-t border-gray-200">
                    <div class="flex space-x-3">
                        <button type="button" onclick="saveDraft()" 
                                class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-save mr-2"></i>حفظ كمسودة
                        </button>
                        <button type="button" onclick="previewAnnouncement()" 
                                class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-eye mr-2"></i>معاينة
                        </button>
                    </div>
                    <div class="flex space-x-3">
                        <a href="{% url 'staff_panel:announcement_management' %}" 
                           class="bg-gray-300 hover:bg-gray-400 text-gray-700 px-6 py-2 rounded-lg transition-colors">
                            إلغاء
                        </a>
                        <button type="submit" 
                                class="bg-blue-600 hover:bg-blue-700 text-white px-6 py-2 rounded-lg transition-colors">
                            <i class="fas fa-bullhorn mr-2"></i>نشر الإعلان
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
// Show/hide program selection based on target audience
document.getElementById('target_audience').addEventListener('change', function() {
    const programSelection = document.getElementById('program_selection');
    if (this.value === 'specific_program') {
        programSelection.classList.remove('hidden');
        document.getElementById('specific_program').required = true;
    } else {
        programSelection.classList.add('hidden');
        document.getElementById('specific_program').required = false;
    }
});

// File upload handling
document.getElementById('attachments').addEventListener('change', function(e) {
    const fileList = document.getElementById('file-list');
    fileList.innerHTML = '';
    
    Array.from(e.target.files).forEach((file, index) => {
        const fileItem = document.createElement('div');
        fileItem.className = 'flex items-center justify-between bg-white border border-gray-200 rounded p-2';
        fileItem.innerHTML = `
            <div class="flex items-center">
                <i class="fas fa-file text-gray-400 mr-2"></i>
                <span class="text-sm text-gray-700">${file.name}</span>
                <span class="text-xs text-gray-500 ml-2">(${(file.size / 1024 / 1024).toFixed(2)} MB)</span>
            </div>
            <button type="button" onclick="removeFile(${index})" class="text-red-500 hover:text-red-700">
                <i class="fas fa-times"></i>
            </button>
        `;
        fileList.appendChild(fileItem);
    });
});

// Live preview functionality
function updatePreview() {
    const title = document.getElementById('title').value;
        const content = document.getElementById('content').value;
        const priority = document.getElementById('priority').value;
    
    const previewContent = document.getElementById('preview-content');
    
    if (title || content) {
        const priorityColors = {
            'low': 'bg-blue-100 text-blue-800',
            'medium': 'bg-yellow-100 text-yellow-800',
            'high': 'bg-orange-100 text-orange-800',
            'urgent': 'bg-red-100 text-red-800'
        };
        
        previewContent.innerHTML = `
            <div class="text-left">
                <div class="flex items-center space-x-2 mb-3">
                    ${priority ? `<span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${priorityColors[priority] || 'bg-gray-100 text-gray-800'}">
                        ${priority.charAt(0).toUpperCase() + priority.slice(1)} Priority
                    </span>` : ''}
                </div>
                <h3 class="text-xl font-bold text-gray-900 mb-3">${title || 'Announcement Title'}</h3>
                <div class="text-gray-700 whitespace-pre-line">${content || 'Announcement content will appear here...'}</div>
                <div class="mt-4 text-sm text-gray-500">
                    <i class="fas fa-user mr-1"></i>Posted by Staff
                    <i class="fas fa-calendar ml-3 mr-1"></i>${new Date().toLocaleDateString()}
                </div>
            </div>
        `;
    } else {
        previewContent.innerHTML = `
            <div class="text-center text-gray-500 py-8">
                <i class="fas fa-eye text-3xl mb-2"></i>
                <p>Preview will appear here as you type</p>
            </div>
        `;
    }
}

// Add event listeners for live preview
document.getElementById('title').addEventListener('input', updatePreview);
document.getElementById('content').addEventListener('input', updatePreview);
document.getElementById('priority').addEventListener('change', updatePreview);


// Set default publish date to now
document.addEventListener('DOMContentLoaded', function() {
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('publish_date').value = now.toISOString().slice(0, 16);
});

function removeFile(index) {
    // This would need to be implemented with proper file handling
    console.log('Remove file at index:', index);
}

function saveDraft() {
    alert('Draft saved successfully!');
}

function previewAnnouncement() {
    // Open preview in new window or modal
    alert('Preview functionality will open in a new window.');
}
</script>
{% endblock %}